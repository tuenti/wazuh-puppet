# Wazuh App Copyright (C) 2019 Wazuh Inc. (License GPLv2)
#Define for a specific ossec vulnerability feed
define wazuh::vulnerabilityfeed(
  Optional[Stdlib::Absolutepath]  $path = undef,
  Optional[Stdlib::HTTPUrl]       $url = undef,
  Stdlib::Port                    $url_port = 443,
  Enum['yes','no']                $disabled = 'yes',
  String                          $update_interval = '1h',
  Optional[Array[String]]         $allow = undef,
  Optional[Integer]               $update_from_year = undef
) {
  require wazuh::params_manager

  if !$wazuh::params_manager::configure_vulnerability_detector {
    fail('Cannot define vulnerability feeds without enabling vulnerability detector.')
  }
  if $url and $path {
    fail('Cannot define vulnerability feeds with both URL and path.')
  }

  concat::fragment { $name:
    target  => 'ossec.conf',
    order   => 46,
    content => template('wazuh/fragments/_wodle_vulnerability_detector_feed.erb')
  }
}
