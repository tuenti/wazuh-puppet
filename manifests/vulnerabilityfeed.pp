# Wazuh App Copyright (C) 2019 Wazuh Inc. (License GPLv2)
#Define for a specific ossec vulnerability feed
define wazuh::vulnerabilityfeed(
  Stdlib::Absolutepath  $path,
  Stdlib::HTTPUrl       $url,
  Stdlib::Port          $url_port = '443',
  Enum['yes','no']      $disabled = 'yes',
  String                $update_interval = '1h',
  Array[String]         $allow = [],
  Int                   $update_from_year = '2010'
) {
  require wazuh::manager

  if !$wazuh::manager::configure_vulnerability_detector {
    fail('Cannot define vulnerability feeds without vulnerability detector')
  }
  if defined( $url ) and defined( $path ) {
    fail('Cannot define vulnerability feeds with both URL and path.')
  }

  concat::fragment { $name:
    target  => 'ossec.conf',
    order   => 46,
    content => template('wazuh/fragments/_vulnerabilityfeed.erb')
  }
}
